name: ğŸ›’ Actions Marketplace - VersÃ£o Segura

on:
  workflow_dispatch:
    inputs:
      message:
        description: 'Mensagem para testar'
        required: true
        default: 'OlÃ¡ GitHub Actions!'

permissions:
  contents: read
  actions: read

jobs:
  marketplace-safe:
    name: "ğŸ“¦ Actions Essenciais (Sem Issues)"
    runs-on: ubuntu-latest
    
    steps:
      # 1. CHECKOUT
      - name: "ğŸ“¥ Baixar cÃ³digo"
        uses: actions/checkout@v4
        
      # 2. SETUP NODE
      - name: "ğŸŸ¢ Configurar Node.js"
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      # 3. INFORMAÃ‡Ã•ES DO CONTEXTO
      - name: "â„¹ï¸ Mostrar informaÃ§Ãµes"
        run: |
          echo "ğŸ¯ Mensagem recebida: ${{ github.event.inputs.message }}"
          echo "ğŸ‘¤ Executado por: ${{ github.actor }}"
          echo "ğŸ“… Data: $(date)"
          echo "ğŸŒ¿ Branch: ${{ github.ref_name }}"
          echo "ğŸ·ï¸ Repo: ${{ github.repository }}"
          
      # 4. CRIAR ARQUIVO SIMPLES
      - name: "ğŸ“„ Criar relatÃ³rio"
        run: |
          cat > relatorio.md << EOF
          # ğŸ“Š RelatÃ³rio do GitHub Actions
          
          ## InformaÃ§Ãµes da ExecuÃ§Ã£o
          - **Mensagem:** ${{ github.event.inputs.message }}
          - **UsuÃ¡rio:** ${{ github.actor }}
          - **Data:** $(date)
          - **Workflow:** ${{ github.workflow }}
          - **Repository:** ${{ github.repository }}
          - **Run ID:** ${{ github.run_id }}
          
          ## Sistema
          - **OS:** ${{ runner.os }}
          - **Arquitetura:** ${{ runner.arch }}
          
          ## Status
          âœ… Workflow executado com sucesso!
          EOF
          
          echo "ğŸ“„ RelatÃ³rio criado:"
          cat relatorio.md
          
      # 5. UPLOAD ARTIFACT
      - name: "ğŸ“¤ Upload do relatÃ³rio"
        uses: actions/upload-artifact@v4
        with:
          name: relatorio-execution
          path: relatorio.md
          
      # 6. CACHE DEMONSTRATION
      - name: "âš¡ DemonstraÃ§Ã£o de Cache"
        uses: actions/cache@v3
        with:
          path: |
            ~/.npm
            ~/.cache
          key: ${{ runner.os }}-cache-${{ hashFiles('**/package*.json') }}
          restore-keys: |
            ${{ runner.os }}-cache-
            
      # 7. MULTIPLE COMMANDS
      - name: "ğŸ”§ Comandos mÃºltiplos"
        run: |
          echo "ğŸš€ Executando vÃ¡rios comandos..."
          
          echo "1ï¸âƒ£ Verificando versÃµes:"
          node --version
          npm --version
          
          echo "2ï¸âƒ£ InformaÃ§Ãµes do sistema:"
          whoami
          pwd
          ls -la
          
          echo "3ï¸âƒ£ VariÃ¡veis importantes:"
          echo "GITHUB_WORKSPACE: $GITHUB_WORKSPACE"
          echo "GITHUB_ACTOR: $GITHUB_ACTOR"
          echo "GITHUB_REPOSITORY: $GITHUB_REPOSITORY"
          
          echo "âœ… Todos os comandos executados!"
          
      # 8. CONDITIONAL STEP
      - name: "ğŸ¯ Step condicional"
        if: github.event.inputs.message == 'especial'
        run: |
          echo "ğŸŒŸ VocÃª digitou a mensagem especial!"
          echo "ğŸ‰ Este step sÃ³ executa quando message = 'especial'"
          
      # 9. STEP SUMMARY
      - name: "ğŸ“Š Resumo final"
        run: |
          echo "## ğŸ‰ ExecuÃ§Ã£o ConcluÃ­da!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“‹ Detalhes:" >> $GITHUB_STEP_SUMMARY
          echo "- **Mensagem:** ${{ github.event.inputs.message }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Executor:** ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Data:** $(date)" >> $GITHUB_STEP_SUMMARY
          echo "- **Status:** âœ… Sucesso" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“ Artefatos Gerados:" >> $GITHUB_STEP_SUMMARY
          echo "- relatorio-execution.md" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ğŸš€ **PrÃ³ximo passo:** Baixe o artefato para ver o relatÃ³rio completo!"